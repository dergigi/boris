import { getAddressPointerForEvent, isAddressPointer } from "applesauce-core/helpers";
import { ensureAddressPointerTag } from "../helpers/common-tags.js";
import { eventPipe, skip } from "../helpers/pipeline.js";
import { includeEmojis, includeQuoteTags, repairNostrLinks, setContent, setContentWarning, tagPubkeyMentions, } from "./content.js";
import { modifyPublicTags } from "./tags.js";
/** Sets the message content for a stream chat event */
export function setMessage(content, options) {
    return eventPipe(
    // set text content
    setContent(content), 
    // fix @ mentions
    repairNostrLinks(), 
    // include "p" tags for pubkeys mentioned
    tagPubkeyMentions(), 
    // include event "q" tags
    includeQuoteTags(), 
    // include "emoji" tags
    options?.emojis ? includeEmojis(options.emojis) : skip(), 
    // set "content-warning" tag
    options?.contentWarning !== undefined ? setContentWarning(options.contentWarning) : skip());
}
/** Sets the stream for a stream chat event */
export function setStream(stream) {
    if (!isAddressPointer(stream))
        stream = getAddressPointerForEvent(stream);
    return modifyPublicTags((tags) => ensureAddressPointerTag(tags, stream));
}
